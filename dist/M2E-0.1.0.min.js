(function(e){function t(){this.events={}}function r(e,t){var r=e+s+JSON.stringify(t);return r}function n(e){var t=e.indexOf(s);if(!~t)throw Error("Invalid M2E message");var r=e.substring(0,t),n=e.substring(t+1),i=JSON.parse(n);return{name:r,args:i}}function i(){t.call(this)}function u(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}t.prototype.listen=function(e,t,r){this.events.hasOwnProperty(e)||(this.events[e]={queue:[],map:{}});var n=this.events[e];~n.queue.indexOf(t)||(n.queue.push(t),n.map[t]=r)},t.prototype.ignore=function(e,t){if(!this.events.hasOwnProperty(e))return!1;var r=this.events[e];if(!r||0===r.queue.length)return!1;var n=r.queue.indexOf(t);return~n?(r.queue.splice(idx,1),delete r.map[t],0===r.queue.length&&delete this.events[e],!0):!1},t.prototype.trigger=function(e,t){var r=this.events[e];if(!r||0===r.queue.length)return!1;for(var n=0;r.queue.length>n;++n){var i=r.queue[n],u=r.map[i];i.apply(u,t)}return!0},t.prototype.fire=function(e){var t=Array.prototype.slice.call(arguments,1);this.trigger(e,t)};var s=":";u(i,t),i.prototype.trigger=function(e,t){var n=r(e,t);this.sendMessage(n)},i.prototype.onmessage=function(e){var r=n(e),i=t.prototype.trigger;i.call(this,r.name,r.args)},e.M2E=i})(self);